<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <link type="text/css" href="gp-style.css" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <h1>Genome Poperties Viewer</h1>
    <div class="top-block">
        <div id="gp-controllers" class="top-controllers">
            <div>
                <header>Taxonomy Options</header>
                <ul>
                    <li><label for="tax-search">Search:</label><br/>
                        <input type="text" id="tax-search">
                    </li>
                    <li><input type="checkbox" id="collapse_tree" checked="checked"/><label for="collapse_tree">Collapse tree</label></li>
                    <li><label for="tax_label">Labels:</label><br/>
                        <select id="tax_label">
                            <option value="name">Species</option>
                            <option value="id">Tax ID</option>
                            <option value="both">Both</option>
                        </select>
                    </li>

                </ul>
            </div>
            <div>
                <header>Genome Properties Options</header>
                <ul>
                    <li><label for="gp-selector">Top level category:</label><br/>
                        <div id="gp-selector" class="selector"></div>
                    </li>
                    <li><label for="gp-filter">Filter:</label><br/>
                        <input type="text" id="gp-filter">
                    </li>
                    <li><label for="gp_label">Label:</label><br/>
                        <select id="gp_label">
                            <option value="name">Name</option>
                            <option value="id">ID</option>
                            <option value="both">Both</option>
                        </select>
                    </li>
                </ul>
            </div>
            <div class="gp-legends">
                <header>Legends</header>
            </div>
            <a class="minimise"></a>
        </div>
    </div>
    <div id="gp-viewer"></div>
    <div class="info-tooltip"></div>
</div>
<script src="bin/d3.custom.min.js"></script>
<script>
    var d3 = gpv.d3,
            GenomePropertiesViewer = gpv.GenomePropertiesViewer,
            viewer = new GenomePropertiesViewer({
                element_selector: "#gp-viewer",
                controller_element_selector: "#gp-selector"
            });
    viewer.update_viewer();
    d3.select("#upload-button").on("click", function() {
        var ids = d3.select("#tax-ids-text").node().value
                .split(/[\s,-]/)
                .filter(function(e) { return e.trim().length>0;});
        for (var i =0;i<ids.length;i++){
            var id = ids[i];
            viewer.load_genome_properties_file(id.trim());
        }
    });
    d3.select("#order").on("change", function() {
        viewer.order_organisms(this.value);
    });
    d3.select("#collapse_tree").on("change", function() {
        viewer.gp_taxonomy.collapse_tree = d3.select(this).property('checked');
        viewer.update_viewer();
    });
    d3.select(".minimise").on("click",(d,i,c)=>{
        const on = d3.select(c[i]).classed("on");
        d3.selectAll(".top-controllers>div")
                .style("max-height", on?"0px":"500px")
                .style("overflow", on?null:"hidden")
                .transition(200)
                .style("max-height", on?"500px":"0px")
                .style("opacity", on?1:0);
//        d3.select(c[i]).transition(200).style("transform", on?"rotate(0deg)":"rotate(180deg)");
        d3.selectAll(".top-controllers").transition(200).style("padding", on?"5px":"0px");
        d3.select(c[i]).classed("on", !on);
        setTimeout(function(){ viewer.refresh_size(); }, 250);

    });

</script>
</body>